{% extends 'base.html' %}

{% block title %}Importer des espèces{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1><i class="fas fa-file-import"></i> Importer des espèces</h1>
                <a href="{% url 'taxonomy:liste_especes' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Retour à la liste
                </a>
            </div>

            <!-- Statistiques -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <h5><i class="fas fa-list"></i> Espèces totales</h5>
                            <h2>{{ stats.total_especes }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <h5><i class="fas fa-dove"></i> Import LOF</h5>
                            <h2>{{ stats.especes_lof }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <h5><i class="fas fa-book"></i> Import TaxRef</h5>
                            <h2>{{ stats.especes_taxref }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-dark">
                        <div class="card-body">
                            <h5><i class="fas fa-user-edit"></i> Manuelles</h5>
                            <h2>{{ stats.especes_manuelles }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Méthode 1: LOF (Recommandé) -->
            <div class="card mb-4 border-success">
                <div class="card-header bg-success text-white">
                    <h4><i class="fas fa-star"></i> Méthode 1: Liste des Oiseaux de France (LOF) - RECOMMANDÉ</h4>
                </div>
                <div class="card-body">
                    <p class="lead">
                        Import automatique depuis la Commission de l'avifaune française (CAF).
                    </p>

                    <div class="row">
                        <div class="col-md-6">
                            <h5>Avantages</h5>
                            <ul>
                                <li>Téléchargement automatique (64KB)</li>
                                <li>Import rapide (10-30 secondes)</li>
                                <li>~577 espèces d'oiseaux de France</li>
                                <li>Noms français + scientifiques</li>
                                <li>Catégories de statut (A, B, C, D, E)</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>Commande</h5>
                            <div class="bg-dark text-light p-3 rounded">
                                <code>python manage.py charger_lof</code>
                            </div>
                            <p class="mt-2 text-muted small">
                                À exécuter depuis le terminal dans le répertoire du projet.
                            </p>
                        </div>
                    </div>

                    <div class="mt-3">
                        <h5>Options disponibles</h5>
                        <ul>
                            <li><code>--categories A,AC</code> : Choisir les catégories à importer</li>
                            <li><code>--limit 50</code> : Mode test (limiter le nombre d'espèces)</li>
                            <li><code>--file /chemin/vers/LOF.xlsx</code> : Import depuis fichier local</li>
                        </ul>
                    </div>

                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle"></i>
                        <strong>Documentation complète</strong> : Consultez <code>taxonomy/README_LOF.md</code>
                    </div>
                </div>
            </div>

            <!-- Méthode 2: TaxRef (Alternative) -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h4><i class="fas fa-book"></i> Méthode 2: TaxRef (INPN/MNHN) - ALTERNATIVE</h4>
                </div>
                <div class="card-body">
                    <p class="lead">
                        Import depuis le référentiel taxonomique national officiel.
                    </p>

                    <div class="row">
                        <div class="col-md-6">
                            <h5>Caractéristiques</h5>
                            <ul>
                                <li>Référentiel officiel MNHN</li>
                                <li>~574 espèces d'oiseaux de France</li>
                                <li>Téléchargement manuel requis (150MB)</li>
                                <li>Import plus long (1-3 minutes)</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>Commande</h5>
                            <div class="bg-dark text-light p-3 rounded">
                                <code>python manage.py charger_taxref --file /chemin/vers/TAXREFv17.txt</code>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Attention</strong> : Le fichier TaxRef doit être téléchargé manuellement depuis
                        <a href="https://inpn.mnhn.fr/telechargement/referentielEspece/referentielTaxo" target="_blank">
                            inpn.mnhn.fr
                        </a>
                    </div>

                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle"></i>
                        <strong>Documentation complète</strong> : Consultez <code>taxonomy/README_TAXREF.md</code>
                    </div>
                </div>
            </div>

            <!-- Dernières espèces importées -->
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-clock"></i> Dernières espèces importées</h4>
                </div>
                <div class="card-body">
                    {% if dernieres_especes %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Nom français</th>
                                    <th>Nom scientifique</th>
                                    <th>Famille</th>
                                    <th>Source</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for espece in dernieres_especes %}
                                <tr>
                                    <td>
                                        <a href="{% url 'taxonomy:detail_espece' espece.id %}">
                                            {{ espece.nom }}
                                        </a>
                                    </td>
                                    <td><em>{{ espece.nom_scientifique }}</em></td>
                                    <td>{{ espece.famille.nom|default:"-" }}</td>
                                    <td>
                                        {% if "LOF" in espece.commentaire %}
                                        <span class="badge bg-success">LOF</span>
                                        {% elif "TaxRef" in espece.commentaire %}
                                        <span class="badge bg-info">TaxRef</span>
                                        {% else %}
                                        <span class="badge bg-secondary">Manuel</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">Aucune espèce importée pour le moment.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
