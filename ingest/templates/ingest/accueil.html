{% extends "base.html" %}
{% load static %}
<!-- templates/importation/accueil.html -->

{% block title %}Importation des transcriptions{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Système d'importation des transcriptions</h1>

    <div class="alert alert-info">
        <p>Ce module permet d'importer les données transcrites à partir des fiches manuscrites scannées vers la base de données principale.</p>
        <p>Processus d'importation simplifié:</p>
        <ol>
            <li>Importer les fichiers JSON</li>
            <li>Extraire les espèces et créer automatiquement les observateurs</li>
            <li>Valider les espèces si nécessaire</li>
            <li>Préparer les importations</li>
            <li>Finaliser les importations</li>
        </ol>
    </div>
    <!-- Ajout du bouton pour voir le résumé des importations -->
    <div class="mb-4">
        <a href="{% url 'resume_importation' %}" class="btn btn-info">
            <i class="fas fa-chart-bar"></i> Voir le résumé des importations
        </a>
    </div>
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Transcriptions</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Total:</span>
                        <strong>{{ total_transcriptions }}</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Traitées:</span>
                        <strong>{{ transcriptions_traitees }}</strong>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>En attente:</span>
                        <strong>{{ total_transcriptions|add:"-"|add:transcriptions_traitees }}</strong>
                    </div>

                    <div class="mt-3">
                        <a href="{% url 'importer_json' %}" class="btn btn-primary">Importer des fichiers JSON</a>
                        <a href="{% url 'extraire_candidats' %}" class="btn btn-secondary">Extraire les candidats</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Réconciliation</h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless mb-0">
                        <thead>
                            <tr>
                                <th class="text-center" style="width: 33.33%;"><i class="fas fa-dove"></i> Espèces</th>
                                <th class="text-center" style="width: 33.33%;"><i class="fas fa-users"></i> Observateurs</th>
                                <th class="text-center" style="width: 33.33%;"><i class="fas fa-map-marker-alt"></i> Communes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Candidates:</span>
                                        <strong>{{ especes_candidates }}</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Validées:</span>
                                        <strong>{{ especes_validees }}</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-3">
                                        <span>En attente:</span>
                                        <strong>{{ especes_candidates|add:"-"|add:especes_validees }}</strong>
                                    </div>
                                    <div class="text-center">
                                        <a href="{% url 'liste_especes_candidates' %}" class="btn btn-info">
                                            <i class="fas fa-cog"></i> Gérer les espèces
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Créés lors de cette transcription:</span>
                                        <strong>{{ observateurs_transcription }}</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Nombre total d'observateurs:</span>
                                        <strong>{{ total_observateurs }}</strong>
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Trouvées lors de cette transcription:</span>
                                        <strong>{{ communes_transcription|default:"0" }}</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Dans l'ensemble des fiches:</span>
                                        <strong>{{ communes_fiches|default:"0" }}</strong>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Importations</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>En attente:</span>
                        <strong>{{ importations_en_attente }}</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>En erreur:</span>
                        <strong>{{ importations_erreur }}</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Terminées:</span>
                        <strong>{{ importations_completees }}</strong>
                    </div>

                    <div class="mt-3">
                        <a href="{% url 'preparer_importations' %}" class="btn btn-info">Préparer les importations</a>
                        <a href="{% url 'liste_importations' %}" class="btn btn-info">Gérer les importations</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}